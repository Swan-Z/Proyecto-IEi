<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de centros educativos</title>
</head>
<body>

<h1>Buscador de centros educativos</h1>

<div>
    <label for="localidad">Localidad:</label>
    <input type="text" id="localidad" />
</div>

<div>
    <label for="codigoPostal">Código Postal:</label>
    <input type="text" id="codigoPostal" />
</div>

<div>
    <label for="provincia">Provincia:</label>
    <input type="text" id="provincia" />
</div>

<div>
    <label for="tipo">Tipo:</label>
    <select id="tipo">
        <option value="Público">Público</option>
        <option value="Privado">Privado</option>
        <option value="Concertado">Concertado</option>
        <option value="Otro">Otro</option>
    </select>
</div>

<div>
    <button onclick="cancelar()">Cancelar</button>
    <button onclick="buscar()">Buscar</button>
</div>

<script>
    function obtenerValores() {
        const localidad = document.getElementById("localidad").value;
        const codigoPostal = document.getElementById("codigoPostal").value;
        const provincia = document.getElementById("provincia").value;
        const tipo = document.getElementById("tipo").value;

        return { localidad, codigoPostal, provincia, tipo };
    }

    function cancelar() {
        document.getElementById("localidad").value = "";
        document.getElementById("codigoPostal").value = "";
        document.getElementById("provincia").value = "";
        document.getElementById("tipo").value = "";

        console.log("Cancelando...");
    }

    import { createClient } from '@supabase/supabase-js';

    // Configuración de Supabase
    const supabaseUrl = 'https://wxohstsphwlwjzsisprz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind4b2hzdHNwaHdsd2p6c2lzcHJ6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY5NzYzMDAwOCwiZXhwIjoyMDEzMjA2MDA4fQ.Cg7nycY-fxGbHcgsGSYOZhJsvsJf7Q0vqGqq7w2vycQ'; 
    const centroEducativoTable = 'centro_educativo';
    const localidadTable = 'localidad';

    // Crear una instancia de Supabase client para interactuar con la base de datos
    const supabase = createClient(supabaseUrl, supabaseKey);

    function buscar() {
        const localidad = document.getElementById('localidad').value;
        const codigoPostal = document.getElementById('codigoPostal').value;
        const provincia = document.getElementById('provincia').value;
        const tipo = document.getElementById('tipo').value;

        // Añadir cualquier lógica necesaria para buscar aquí
        console.log('Buscando...');
        console.log('Localidad:', localidad);
        console.log('Código Postal:', codigoPostal);
        console.log('Provincia:', provincia);
        console.log('Tipo:', tipo);

        const sqlQuery = `
            SELECT ce.*
            FROM ${centroEducativoTable} ce
            JOIN ${localidadTable} l ON ce.id_localidad = l.id
            WHERE l.en_provincia = '${provincia}'
                AND l.nombre = '${localidad}'
                AND ce.codigo_postal = '${codigoPostal}'
                AND ce.tipo = '${tipo}';
        `;

        // Realizar la consulta a la base de datos de Supabase
        supabase.rpc('select', { params: [], sql: sqlQuery })
            .then(({ data, error }) => {
                if (error) {
                    console.error('Error al realizar la consulta a Supabase:', error);
                } else {
                    // Manipular los datos obtenidos de Supabase
                    console.log(data);
                }
            })
            .catch(error => {
                console.error('Error al realizar la consulta a Supabase:', error);
            });
    }

</script>

</body>
</html>
