<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de centros educativos</title>
</head>
<body>

<h1>Buscador de centros educativos</h1>

<div>
    <label for="localidad">Localidad:</label>
    <input type="text" id="localidad" />
</div>

<div>
    <label for="codigoPostal">Código Postal:</label>
    <input type="text" id="codigoPostal" />
</div>

<div>
    <label for="provincia">Provincia:</label>
    <input type="text" id="provincia" />
</div>

<div>
    <label for="tipo">Tipo:</label>
    <select id="tipo">
        <option value="Público">Público</option>
        <option value="Privado">Privado</option>
        <option value="Concertado">Concertado</option>
        <option value="Otro">Otro</option>
    </select>
</div>


<div id="fuente"></div>


<div>
    <button onclick="cancelar()">Cancelar</button>
    <button onclick="buscar()">Buscar</button>
</div>

<script>
    function obtenerValores() {
        const localidad = document.getElementById("localidad").value;
        const codigoPostal = document.getElementById("codigoPostal").value;
        const provincia = document.getElementById("provincia").value;
        const tipo = document.getElementById("tipo").value;

        return { localidad, codigoPostal, provincia, tipo };
    }

    function cancelar() {
        document.getElementById("localidad").value = "";
        document.getElementById("codigoPostal").value = "";
        document.getElementById("provincia").value = "";
        document.getElementById("tipo").value = "";

        console.log("Cancelando...");
    }


    async function buscar() {
    try {
        
        const { localidad, codigoPostal, provincia, tipo } = obtenerValores();

        // Verificar si hay datos antes de continuar
        if (localidad === "" && codigoPostal === "" && provincia === "" && tipo === "") {
            console.warn('No se encontraron datos.');
            return;
        }
     
        const url = `http://localhost:8000/busqueda/${localidad}/${provincia}/${codigoPostal}/${tipo}`;
        const response = await fetch(url, { method: 'GET'});
        if (!response.ok) {
            console.error('Error al cargar datos desde el backend:', response);
            return;
        }

        const datos = await response.json();
        const tablaHTML = `<div style="max-width: auto; margin: 0 auto; font-size: 16px;">
                            <table style="border-collapse: collapse; width: 100%; border: 1px solid #dddddd;">
                                <thead>
                                    <tr>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Nombre</th>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Tipo</th>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Dirección</th>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Localidad</th>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Cód.Postal</th>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Provincia</th>
                                        <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Descripción</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${datos.map(item => 
                                        `<tr><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${item.nombre}
                                        </td><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${item.tipo}
                                        </td><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${item.direccion}
                                        </td><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${document.getElementById("localidad").value}
                                        </td><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${item.codigo_postal}
                                        </td><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${document.getElementById("provincia").value}
                                        </td><td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${item.descripcion}
                                        </td></tr>`).join('')}
                                </tbody>
                            </table>
                        </div>`; 

        // Cambiar el contenido HTML del elemento con id "fuente"
        document.getElementById('fuente').innerHTML = tablaHTML;
    } catch (error) {
        console.error('Error al cargar datos desde el backend:', error);
    }
}






</script>

</body>
</html>
